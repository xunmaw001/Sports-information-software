(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/shop-order-confirm/shop-order-confirm"],{"06df":function(e,t,r){"use strict";var o,s=function(){var e=this,t=e.$createElement;e._self._c},n=[];r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return o}))},"13f6":function(e,t,r){"use strict";(function(e){r("6496"),r("921b");o(r("66fd"));var t=o(r("a979"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,r("543d")["createPage"])},2215:function(e,t,r){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=s(r("a34a"));function s(e){return e&&e.__esModule?e:{default:e}}function n(e,t,r,o,s,n,a){try{var d=e[n](a),i=d.value}catch(u){return void r(u)}d.done?t(i):Promise.resolve(i).then(o,s)}function a(e){return function(){var t=this,r=arguments;return new Promise((function(o,s){var a=e.apply(t,r);function d(e){n(a,o,s,d,i,"next",e)}function i(e){n(a,o,s,d,i,"throw",e)}d(void 0)}))}}var d={data:function(){return{user:{},orderGoods:{},address:{},total:0,type:1,seat:0}},onLoad:function(){var t=a(o.default.mark((function t(r){var s;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.type=r.type,this.seat=r.seat,this.orderGoods=e.getStorageSync("orderGoods"),1!=this.seat)for(s=0;s<this.orderGoods.length;s++)0==this.total?this.total=parseFloat(this.orderGoods[s].price)*this.orderGoods[s].buynumber:this.total=parseFloat(this.total)+parseFloat(this.orderGoods[s].price)*this.orderGoods[s].buynumber;else this.total=parseFloat(this.orderGoods[0].total),this.address=this.orderGoods[0].address;this.total=this.total.toFixed(2);case 5:case"end":return t.stop()}}),t,this)})));function r(e){return t.apply(this,arguments)}return r}(),onShow:function(){var t=a(o.default.mark((function t(){var r,s,n;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.getStorageSync("nowTable"),t.next=3,this.$api.session(r);case 3:if(s=t.sent,this.user=s.data,1==this.seat){t.next=15;break}if(n=e.getStorageSync("address"),!n||this.user.id!=this.address.userid){t.next=11;break}this.address=e.getStorageSync("address"),t.next=15;break;case 11:return t.next=13,this.$api.defaultAddress(this.user.id);case 13:s=t.sent,this.address=s.data;case 15:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),methods:{onSubmitTap:function(){var t=a(o.default.mark((function t(){var r,s;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=this,s=e.getStorageSync("nowTable"),e.showModal({title:"提示",content:"是否确认支付",success:function(){var t=a(o.default.mark((function t(n){var a,d,i,u,c,f;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!n.confirm){t.next=40;break}if(a=r.type,d=!0,i="已支付",1!=a){t.next=8;break}r.user.money-r.total<0&&(r.$utils.msg("余额不足，请先充值"),d=!1,i="未支付"),t.next=13;break;case 8:if(2!=a){t.next=13;break}if(!(r.user.jifen-r.total<0)){t.next=13;break}return r.$utils.msg("积分不足，兑换商品失败"),d=!1,t.abrupt("return");case 13:u=0;case 14:if(!(u<r.orderGoods.length)){t.next=26;break}return c={orderid:r.$utils.genTradeNo(),tablename:r.orderGoods[u].tablename,userid:r.user.id,goodid:r.orderGoods[u].goodid,goodname:r.orderGoods[u].goodname,picture:r.orderGoods[u].picture,buynumber:r.orderGoods[u].buynumber,discountprice:r.orderGoods[u].price,price:r.orderGoods[u].price,total:r.orderGoods[u].price*r.orderGoods[u].buynumber,discounttotal:r.orderGoods[u].price*r.orderGoods[u].buynumber,type:a,address:r.address.address,tel:r.address.phone,consignee:r.address.name,status:i},1==r.seat&&(c["address"]=r.address,f=r.address.split(",").length,c["buynumber"]=f,c["total"]=r.orderGoods[u].price*f,c["discounttotal"]=r.orderGoods[u].price*f),t.next=19,r.$api.add("orders",c);case 19:if(!r.orderGoods[u].id){t.next=23;break}return t.next=22,r.$api.del("cart",JSON.stringify([r.orderGoods[u].id]));case 22:e.removeStorageSync("cart".concat(r.orderGoods[u].goodid).concat(r.user.id));case 23:u++,t.next=14;break;case 26:if(!d){t.next=40;break}if(1!=a){t.next=35;break}return r.$utils.msgBack("支付成功"),r.user.money=r.user.money-r.total,(r.user.jifen||0==r.user.jifen)&&(r.user.jifen=parseFloat(r.user.jifen)+parseFloat(r.total)),t.next=33,r.$api.update(s,r.user);case 33:t.next=40;break;case 35:if(2!=a){t.next=40;break}return r.$utils.msgBack("兑换成功"),r.user.jifen=r.user.jifen-r.total,t.next=40,r.$api.update(s,r.user);case 40:case"end":return t.stop()}}),t)})));function n(e){return t.apply(this,arguments)}return n}()});case 3:case"end":return t.stop()}}),t,this)})));function r(){return t.apply(this,arguments)}return r}(),onAddressTap:function(){this.$utils.jump("../shop-address/shop-address")}}};t.default=d}).call(this,r("543d")["default"])},"3b26":function(e,t,r){},"66e7":function(e,t,r){"use strict";var o=r("3b26"),s=r.n(o);s.a},a979:function(e,t,r){"use strict";r.r(t);var o=r("06df"),s=r("df51");for(var n in s)"default"!==n&&function(e){r.d(t,e,(function(){return s[e]}))}(n);r("66e7");var a,d=r("f0c5"),i=Object(d["a"])(s["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);t["default"]=i.exports},df51:function(e,t,r){"use strict";r.r(t);var o=r("2215"),s=r.n(o);for(var n in o)"default"!==n&&function(e){r.d(t,e,(function(){return o[e]}))}(n);t["default"]=s.a}},[["13f6","common/runtime","common/vendor"]]]);